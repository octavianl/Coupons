<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<title>Cart Model | Hero User Guide</title>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
		<script type="text/javascript" src="./../../js/shCore.js"></script>
		<script type="text/javascript" src="./../../js/shBrushPhp.js"></script>
		<script type="text/javascript" src="./../../js/shBrushXml.js"></script>
		<script type="text/javascript" src="./../../js/user_guide.js"></script>
		<link href="./../../css/user_guide.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="./../../css/shCore.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="./../../css/shThemeDefault.css" media="screen" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div class="header">
			Hero <span class="sub">/ User Guide</span>
		</div>
		<div class="body">
			<div id="navigation">
				<ul>
					<li>
						<a rel="basic" class="parent" href="#">Basic Details</a>
						<ul>
							<li>
								<a href="./../../index.html">Welcome to Hero</a>
							</li>
							<li>
								<a href="./../../license.html">License Agreement</a>
							</li>
							<li>
								<a href="./../../changelog.html">Changelog</a>
							</li>
						</ul>
					</li>
					<li>
						<a rel="installation" class="parent" href="#">Installation</a>
						<ul>
							<li>
								<a href="./../../installation/server_requirements.html">Server Requirements</a>
							</li>
							<li>
								<a href="./../../installation/installation.html">Fresh Installation</a>
							</li>
							<li>
								<a href="./../../installation/upgrading.html">Upgrading</a>
							</li>
							<li>
								<a href="./../../installation/migration.html">Migration</a>
							</li>
							<li>
								<a href="./../../installation/troubleshooting.html">Troubleshooting</a>
							</li>
							<li>
								<a href="./../../installation/deployment.html">Mass Deployment</a>
							</li>
						</ul>
					</li>
					<li>
						<a rel="configuration" class="parent" href="#">Configuration</a>
						<ul>
							<li>
								<a href="./../../configuration/settings.html">Settings</a>
							</li>
							<li>
								<a href="./../../configuration/coupon_codes.html">Coupon Codes</a>
							</li>
							<li>
								<a href="./../../configuration/branding.html">Custom Branding</a>
							</li>
							<li>
								<a href="./../../configuration/custom_fields.html">Custom Fields</a>
							</li>
							<li>
								<a href="./../../configuration/emails.html">Emails</a>
							</li>
							<li>
								<a href="./../../configuration/importing_members.html">Importing Members</a>
							</li>
							<li>
								<a href="./../../configuration/member_groups.html">Member Groups</a>
							</li>
							<li>
								<a href="./../../configuration/payment_gateways.html">Payment Gateways</a>
							</li>
							<li>
								<a href="./../../configuration/reports.html">Reports</a>
							</li>
							<li>
								<a href="./../../configuration/search.html">Search</a>
							</li>
							<li>
								<a href="./../../configuration/security.html">Security</a>
							</li>
							<li>
								<a href="./../../configuration/shipping.html">Shipping Rates</a>
							</li>
							<li>
								<a href="./../../configuration/subscriptions.html">Subscriptions</a>
							</li>
							<li>
								<a href="./../../configuration/taxes.html">Taxes</a>
							</li>
							<li>
								<a href="./../../configuration/advanced.html">Advanced</a>
							</li>
						</ul>
					</li>
					<li>
						<a rel="publishing" class="parent" href="#">Publishing</a>
						<ul>
							<li><a href="./../../publishing/blogs.html">Blogs</a></li>
							<li><a href="./../../publishing/content.html">Content &amp; Content Types</a></li>
							<li><a href="./../../publishing/forms.html">Forms</a></li>
							<li><a href="./../../publishing/menus.html">Navigation Menus</a></li>
							<li><a href="./../../publishing/rss_feeds.html">RSS Feeds</a></li>
							<li><a href="./../../publishing/store.html">Store Products &amp; Collections</a>
							<li><a href="./../../publishing/topics.html">Topics</a></li>
						</ul>
					</li>
					<li>
						<a rel="designers" class="parent" href="#">Designing</a>
						<ul>
							<li><a href="./../../designers/index.html">Designer Introduction</a></li>
							<li><a href="./../../designers/smarty.html">Smarty Template Engine</a></li>
							<li><a href="./../../designers/includes.html">Stylesheets &amp; JavaScript</a></li>
							<li><a href="./../../designers/template_plugins.html">Template Plugins</a></li>
							<li><a href="./../../designers/mapping_urls.html">Mapping URL's</a></li>
							<li class="reference">Reference</li>
							<li class="reference"><a href="./../../designers/reference/global_variables.html">Global Variables</a></li>
							<li class="reference"><a href="./../../designers/reference/global_plugins.html">Global Plugins</a></li>
							<li class="reference"><a href="./../../designers/reference/blogs.html">Blogs &amp; Archives</a></li>
							<li class="reference"><a href="./../../designers/reference/custom_fields.html">Custom Fields</a></li>
							<li class="reference"><a href="./../../designers/reference/forms.html">Forms</a></li>
							<li class="reference"><a href="./../../designers/reference/members.html">Members</a></li>
							<li class="reference"><a href="./../../designers/reference/menus.html">Navigation Menus</a></li>
							<li class="reference"><a href="./../../designers/reference/paywall_privileges.html">Access Restrictions &amp; Paywalls</a></li>
							<li class="reference"><a href="./../../designers/reference/publish.html">Published Content &amp; Topics</a></li>
							<li class="reference"><a href="./../../designers/reference/rss_feeds.html">RSS Feeds</a></li>
							<li class="reference"><a href="./../../designers/reference/search.html">Search Forms &amp; Results</a></li>
							<li class="reference"><a href="./../../designers/reference/store.html">Store Products &amp; Collections</a></li>
							<li class="reference"><a href="./../../designers/reference/subscriptions.html">Subscriptions</a></li>
							<li class="reference"><a href="./../../designers/reference/custom_fields.html">Custom Fields</a></li>
						</ul>
					</li>
					<li>
						<a rel="developers" class="parent active" href="#">Developing</a>
						<ul>
							<li><a href="./../../developers/index.html">Developer Introduction</a></li>
							<li><a href="./../../developers/codeigniter.html">CodeIgniter</a></li>
							<li><a href="./../../developers/standards.html">Standards &amp; Best Practices</a></li>
							<li><a href="./../../developers/security.html">Security</a></li>
							<li><a href="./../../developers/modules.html">Module Development</a></li>
							<li><a href="./../../developers/template_plugins.html">Template Plugin Development</a></li>
							<li><a href="./../../developers/cronjobs.html">Cronjobs &amp; Automated Processes</a></li>
							<li><a href="./../../developers/forms.html">Forms &amp; Custom Fieldtypes</a></li>
							<li><a href="./../../developers/errors_logging.html">Errors &amp; Logging</a></li>
							<li><a href="./../../developers/profiling.html">Debug/Profile Mode</a></li>
							<li class="reference">Reference</li>
							<li class="reference"><a href="./../../developers/reference/admin_form_library.html">Admin Form Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/admin_navigation_library.html">Admin Navigation Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/app_hooks_library.html">App Hooks Library</a></li>
							<li class="reference"><a href="./../../developers/reference/array_to_csv_library.html">Array to CSV Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/array_to_json_helper.html">Array to JSON Helper</a></li> 
							<li class="reference"><a href="./../../developers/reference/blog_model.html">Blog Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/cart_model.html">Cart Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/clean_string_helper.html">Clean String Helper</a></li> 
							<li class="reference"><a href="./../../developers/reference/collections_mode.html">Collections Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/content_model.html">Content Model</a></li>
							<li class="reference"><a href="./../../developers/reference/content_type_model.html">Content Type Model</a></li>  
							<li class="reference"><a href="./../../developers/reference/coupon_model.html">Coupon Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/custom_fields_model.html">Custom Fields Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/dataset_library.html">Dataset Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/email_model.html">Email Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/fieldtype_library.html">Fieldtype Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/form_builder_library.html">Form Builder Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/form_model.html">Form Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/image_thumb_helper.html">Image Thumb Helper</a></li>
							<li class="reference"><a href="./../../developers/reference/invoice_model.html">Invoice Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/head_assets_library.html">Head Assets Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/link_model.html">Link Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/login_model.html">Login Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/menu_model.html">Menu Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/notices_library.html">Notices Library</a></li>
							<li class="reference"><a href="./../../developers/reference/order_model.html">Order Model</a></li>  
							<li class="reference"><a href="./../../developers/reference/products_model.html">Products Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/usergroup_model.html">Usergroup Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/product_option_model.html">Product Option Model</a></li>
							<li class="reference"><a href="./../../developers/reference/rss_model.html">RSS Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/setting_helper.html">Setting Helper</a></li>
							<li class="reference"><a href="./../../developers/reference/settings_model.html">Settings Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/shipping_model.html">Shipping Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/states_model.html">States Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/stats_library.html">Stats Library</a></li> 
							<li class="reference"><a href="./../../developers/reference/subscription_model.html">Subscription Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/subscription_plan_model.html">Subscription Plan Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/taxes_model.html">Taxes Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/template_files_helper.html">Template Files Helper</a></li> 
							<li class="reference"><a href="./../../developers/reference/theme_model.html">Theme Model</a></li>
							<li class="reference"><a href="./../../developers/reference/time_since_helper.html">Time Since Helper</a></li> 
							<li class="reference"><a href="./../../developers/reference/topic_model.html">Topic Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/url_helper.html">URL Helper</a></li> 
							<li class="reference"><a href="./../../developers/reference/user_model.html">User Model</a></li> 
							<li class="reference"><a href="./../../developers/reference/usergroup_model.html">Usergroup Model</a></li> 
						</ul>
						
					</li>
				</ul>
			</div>
			<div id="content">
				<h1>Cart Model</h1>

<p>The Cart model provides Hero logic on top of the <a href="http://codeigniter.com/user_guide/libraries/cart.html">CodeIgniter Cart library</a>.  It also provides methods of saving a user's cart of later use and performing cart-wide calculations.</p>

<h2>Initializations</h2>

<p>The cart model is initialized automatically by the <a href="./../../developers/reference/user_model.html">User model</a>.</p>

<p>To initialize:</p>

<pre class="code brush: php">

$this-&gt;load-&gt;model('store/cart_model');
// methods at $this-&gt;cart_model-&gt;x();

</pre>

<h2>Method Reference</h2>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">add_to_cart</span> <span class="arguments">(int <span class="variable">$product_id</span> [, int <span class="variable">$quantity_id</span> = 1 [, array <span class="variable">$options</span>]])</span></h3>

<p>Add a store product to the cart.  If there are product options, <span class="code">$options</span> should be a name => value array of the product option selections.</p>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">add_subscription_to_cart</span> <span class="arguments">(int <span class="variable">$subscription_plan_id</span> , int <span class="variable">$renew_subscription_id</span>)</span></h3>

<p>Add a subscription plan to the cart.  There can only be one subscription in the cart at one time so, if one already exists, it will be replaced.</p>

<p>If the subscription is a renewal, pass the old subscription as <span class="code">$renew_subscription_id</span>.</p>

<h3 class="method"><span class="return_type">array</span> <span class="method_name">get_subscription_cart</span> <span class="arguments">()</span></h3>

<p>Retrieve the subscription from the cart.  Returns FALSE if no subscription exists.</p>

<pre class="code brush: php">

if ($this-&gt;cart_model-&gt;has_subscription()) {
	$subscription = $this-&gt;cart_model-&gt;get_subscription_cart();
}

</pre>

<p>Subscriptions in the cart have an array with the following data:</p>

<ul>
<li><strong>id</strong></li>
<li><strong>is_subscription</strong> (TRUE)</li>
<li><strong>qty</strong> (1)</li>
<li><strong>price</strong> - The initial charge of the subscription, "0" if it has a free trial.</li>
<li><strong>recurring_price</strong> - The recurring charge for the subscription, "0" if it's a free subscription.</li>
<li><strong>free_trial</strong> - # of free trial days, if applicable.</li>
<li><strong>free_trial_no_billing</strong> - TRUE if the user can subscribe to the free trial without billing information.</li>
<li><strong>interval</strong> - The number of days between recurring charges.</li>
<li><strong>occurrences</strong> - The total number of charges for the subscription.</li>
<li><strong>name</strong> - The name of the subscription.</li>
<li><strong>renew_subscription_id</strong> - The subscription being renewed.</li>
<li><strong>weight</strong> (0)</li>
<li><strong>requires_shipping</strong> (0)</li>
</ul>

<h3 class="method"><span class="return_type">void</span> <span class="method_name">reduce_subscription_prices</span> <span class="arguments">(array <span class="variable">$allowed_subscription_plan_ids</span> , float <span class="variable">$discount</span> [, boolean <span class="variable">$is_percentage</span> = FALSE])</span></h3>

<p>Reduce the subscription price.  This method is called by an active coupon in the checkout controller.  The subscription will only be updated if the first parameter is FALSE or contains the subscription_id of the subscription in the cart.</p>

<h3 class="method"><span class="return_type">void</span> <span class="method_name">update_subscription_trial</span> <span class="arguments">(array <span class="variable">$allowed_subscription_plan_ids</span> , int <span class="variable">$trial_days</span>)</span></h3>

<p>Extend/create a free trial for a subscription.  This method is also called by an active coupon in the checkout controller.  The subscription will only be updated if the first parameter is FALSE or contains the subscription_id of the subscription in the cart.</p>

<h3 class="method"><span class="return_type">void</span> <span class="method_name">reduce_product_prices</span> <span class="arguments">(array <span class="variable">$allowed_product_ids</span> , float <span class="variable">$discount</span> [, boolean <span class="variable">$is_percentage</span> = FALSE])</span></h3>

<p>Reduce the cost of the product(s) in the cart.  This method is also called by an active coupon in the checkout controller.  Product(s) will only be affected if the first parameter is FALSE or if the product in the cart is in that array.</p>

<h3 class="method"><span class="return_type">void</span> <span class="method_name">reset_to_precoupon</span> <span class="arguments">()</span></h3>

<p>Reset all subscription/product prices and trials to their pre-coupon state.  When a second coupon is used (or if a coupon is removed), this method provides an easy way to "reset" the cart and stop from summative coupon using.</p>

<h3 class="method"><span class="return_type">array</span> <span class="method_name">get_cart</span> <span class="arguments">()</span></h3>

<p>Retrieve the full contents of the cart, else FALSE.</p>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">has_subscription</span> <span class="arguments">()</span></h3>

<p>Does the cart contain a subscription?</p>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">has_products</span> <span class="arguments">()</span></h3>

<p>Does the cart contain any products?</p>

<h3 class="method"><span class="return_type">float</span> <span class="method_name">get_total</span> <span class="arguments">()</span></h3>

<p>Retrieve the total cost of the cart for checkout today.  This does not include the subscription's recurring rates, but rather the initial charge of the subscription (if one exists).</p>

<h3 class="method"><span class="return_type">void</span> <span class="method_name">save_cart_to_db</span> <span class="arguments">(array <span class="variable">$cart_array</span>)</span></h3>

<p>Save the shopping cart to the logged-in user's account.  This will load the shopping cart automatically on the user's next visit.</p>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">user_login</span> <span class="arguments">(array <span class="variable">$user</span>)</span></h3>

<p>When a user logs in, this method is called automatically by the <a href="./../../developers/reference/user_model.html">User model</a>.  It loads a user's cart into the session, if one exists.  It also updates pricing to reflect the user's member group status.</p>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">update_quantity</span> <span class="arguments">(string <span class="variable">$rowid</span> , int <span class="variable">$quantity</span>)</span></h3>

<p>Updates the quantity of a product in the cart.</p>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">remove_from_cart</span> <span class="arguments">(string <span class="variable">$rowid</span>)</span></h3>

<p>Arguments:</p>

<ul>
<li><span class="code">$rowid</span> - The unique "rowid" from the $this->cart->contents() array</li>
<li><span class="code">$quantity</span> - The new quantity of the product.</li>
</ul>

<p>Remove a product from the cart.</p>

<p>Arguments:</p>

<ul>
<li><span class="code">$rowid</span> - The unique "rowid" from the $this->cart->contents() array</li>
</ul>

<h3 class="method"><span class="return_type">array</span> <span class="method_name">calculate_totals</span> <span class="arguments">()</span></h3>

<p>Returns an array of calculations based on the content of the cart, for checkout.</p>

<p>Has the elements:</p>

<ul>
<li>float <strong>shipping</strong> - Cost of shipping</li>
<li>float <strong>tax_rate</strong> - Tax percentage</li>
<li>int <strong>tax_id</strong> - The ID of the tax rate being used</li>
<li>float <strong>order_sub_total</strong> - Today's cost, no tax</li>
<li>float <strong>order_tax</strong> - Tax on today's cost</li>
<li>float <strong>order_tax_subscription</strong> - Tax on today's subscription</li>
<li>float <strong>order_tax_products</strong> - Tax on today's products]</li>
<li>float <strong>order_total</strong> - Total cost for today</li>
<li>float <strong>recurring_sub_total</strong> - Cost of recurring charge, no tax</li>
<li>float <strong>recurring_tax</strong> - Tax on the recurring charge</li>
<li>float <strong>recurring_total</strong> - Total recurring cost</li>
<li>int <strong>recurring_interval</strong> - Interval between recurring charges (days)</li>
<li>date <strong>recurring_first_charge</strong> - The date of the subscription's initial charge</li>
<li>date <strong>recurring_last_charge</strong> - The date of the subscription's last charge</li>
</ul>

<h3 class="method"><span class="return_type">boolean</span> <span class="method_name">free_cart</span> <span class="arguments">()</span></h3>

<p>Is the current cart free?  No initial charges or recurring charges?</p>

			</div>
		</div>
	</body>
</html>
<!-- /developers/reference-->